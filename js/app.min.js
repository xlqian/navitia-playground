function makeDeleteButton(){return $("<button/>").addClass("delete").click(function(){$(this).closest(".toDelete").remove(),updateAddPathAC(this),updateUrl(this)}).html('<img src="img/delete.svg" class="deleteButton" alt="delete">')}function insertPathElt(){var e=$("#addPathInput").val();$("#addPathElt").before(makeKeyValue(e,"","path")),autocomplete.addKeyAutocomplete($("#addPathInput"),"pathKey"),$("#addPathInput").val("").change(),$("#addPathElt").prev().find("input").first().focus()}function insertParam(){var e=$("#addParamInput").val();$("#addParam").before(makeKeyValue(e,"","parameters")),$("#addParamInput").val("").change(),$("#addParam").prev().find("input").first().focus()}function makeTemplatePath(e,t){var a=!1;t.closest(".inputDiv").addClass("templateInput"),t.focus(function(){a||(this.value="")}).blur(function(){a||($(this).val()==e||""==$(this).val()?this.value=e:($(this).closest(".inputDiv").removeClass("templateInput"),a=!0))})}function updateAddPathAC(e){var t=$(e).prev();t.hasClass("path")&&($("input path").length||autocomplete.addKeyAutocomplete($("#addPathInput"),"pathKey"))}function updateAddParamAC(){autocomplete.addKeyAutocomplete($("#addParamInput"),"paramKey")}function makeKeyValue(e,t,a){var n=$("<div/>").addClass("inputDiv").addClass("toDelete").append(" ");n.append($("<span/>").addClass("key").text(e));var r=$("<input/>").attr("type","text").attr("placeholder","type your value here").addClass("value").addClass(a).val(t);return autocomplete.valueAutoComplete(r,e),r.on("input",function(){updateUrl(this)}),r.focus(function(){updateUrl(this)}),n.append(r),n.append(makeDeleteButton()),isTemplate(t)&&makeTemplatePath(t,r),n}function getFocusedElemValue(e,t,a){var n=$(e).is("input")?e.value:$(e).text();return a||(n=encodeURIComponent(n)),t==e?sprintf('<span class="focusedParam">%s</span>',n):n}function finalUrl(e){var t=getFocusedElemValue($("#api input.api")[0],e,!0),a="";$("#path .key, #path input.value").each(function(){a+="/"+getFocusedElemValue(this,e)});var n=getFocusedElemValue($("#featureInput")[0],e),r="?";return $("#parameters .key, #parameters input.value").each(function(){r+=getFocusedElemValue(this,e),$(this).hasClass("key")&&(r+="="),$(this).hasClass("value")&&(r+="&")}),void 0===e?t+a+"/"+n+r:sprintf('<span class="api">%s</span><span class="path">%s</span><span class="feature">/%s</span><span class="parameters">%s</span>',t,a,n,r)}function submit(){var e=$("#token input.token").val(),t=finalUrl();window.location=sprintf("?request=%s&token=%s",encodeURIComponent(t),encodeURIComponent(e))}function updateUrl(e){var t=finalUrl(e);$("#requestUrl").html(t)}function getCoverage(){var e=!1,t=null;$("#path .key, #path input.value").each(function(){e&&(t=$(this).val()),e="coverage"==$(this).text()});return t}function makeDatetime(e){$(e).datetimepicker({dateFormat:"yymmdd",timeFormat:"HHmmss",timeInput:!0,separator:"T",controlType:"select",oneLine:!0})}function parseUrl(){var e=new URI(window.location).search(!0),t=e.request;if(isUndefined(t))return null;var a=new URI(t),n=a.origin(),r=a.path().split("/");r=1==r.length?[]:r.slice(1);var o=[],s=!1;r.forEach(function(e){s?o.push(decodeURIComponent(e)):(n+="/"+decodeURIComponent(e),s=/^v\d+$/.test(e))});var i=a.search(!0),p=e.token;return isUndefined(p)&&(p=getTokenFromStorage(n)),{token:p,request:t,api:n,path:o,query:isUndefined(i)?{}:i}}function setAutocomplete(){autocomplete.addKeyAutocomplete($("#featureInput"),"features"),autocomplete.addKeyAutocomplete($("#addPathInput"),"pathKey"),autocomplete.addKeyAutocomplete($("#addParamInput"),"paramKey"),autocomplete.apiAutocomplete()}function setStatus(e,t){var a=sprintf("Status: %s (%s)",e.statusText,e.status);if("number"==typeof t){var n=(new Date).getTime()-t;a+=sprintf(", duration of the request: %sms",n)}$("#status").html(a)}function responseCollectionName(e){var t=null,a=["disruptions","links","feed_publishers","exceptions","notes"];for(var n in e)$.isArray(e[n])&&-1===$.inArray(n,a)&&(t=n);return null===t&&"disruptions"in e&&(t="disruptions"),t}function makeObjectButton(e,t){return $("<label>").addClass("objectButton").append($('<input type="checkbox">').change(t)).append($("<span>").html(e))}function makeObjectButtonHandle(e,t){return function(){var a=$(this).closest("div.object").children("div.data").children(e);$(this).is(":checked")?(a.removeClass("not_filled"),a.html(t())):(a.addClass("not_filled"),a.empty())}}function render(e,t,a,n,r){var o=n;"number"==typeof r&&(o+=sprintf("[%s]",r)),o=e.makeLink(n,t,o);var s=$('<div class="head">');s.append($('<div class="name">').html(o)),s.append($('<div class="summary">').html(summary.run(e,a,t)));var i=$('<div class="button">');extended.hasExtended(e,a,t)&&i.append(makeObjectButton("Ext",makeObjectButtonHandle("div.extended",function(){return extended.run(e,a,t)}))),map.hasMap(e,a,t)&&i.append(makeObjectButton("Map",makeObjectButtonHandle("div.map",function(){return map.run(e,a,t)}))),i.append(makeObjectButton("{ }",makeObjectButtonHandle("div.code",function(){return renderjson(t)}))),s.append(i);var p=$('<div class="data">').append($('<div class="extended not_filled">')).append($('<div class="map not_filled">')).append($('<div class="code not_filled">')),u=$('<div class="object">');return u.append(s),u.append(p),u}function Context(e){var t=URI(window.location).search(!0).token,a=/\{.*\.id\}/;if(this.links={},e instanceof Object&&"links"in e&&$.isArray(e.links)){var n=this;e.links.forEach(function(e){e.templated&&"related"!==e.type&&e.href.match(a)&&(n.links[getType(e.type)]=e.href)})}this.makeHref=function(e){var a=sprintf("?request=%s",encodeURIComponent(e));return t&&(a+=sprintf("&token=%s",encodeURIComponent(t))),a},this.makeLink=function(e,t,n){var r=getType(e);if(!(r in this.links&&"id"in t))return $("<span/>").html(n);var o=this.links[r].replace(a,t.id);return $("<a>").attr("href",this.makeHref(o)).html(n)}}function localStorageAvailable(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(a){return!1}}function saveToken(e,t){localStorageAvailable()&&t&&window.localStorage.setItem(apiStoragePrefix+e,t)}function getTokenFromStorage(e){return localStorageAvailable()?window.localStorage.getItem(apiStoragePrefix+e):void 0}function isUndefined(e){return"undefined"==typeof e}function isPlaceType(e){return-1!==$.inArray(e,["from","to"])}function isDatetimeType(e){return e.match(/datetime$/)}function isAutoCompleteInput(e){return e.attr("class").indexOf("ui-autocomplete-input")>-1}function isDatePicker(e){return e.attr("class").indexOf("ui-autocomplete-input")>-1}function htmlEncode(e){return $("<div/>").text(e).html()}function durationToString(e){var t="",a=e%60,n=Math.floor(e/60)%60,r=Math.floor(e/3600)%24,o=Math.floor(e/86400);return 0!==o&&(t+=sprintf("%sd",o)),0!==r&&(t+=sprintf("%sh",r)),0!==n&&(t+=sprintf("%smin",n)),0!==a&&(t+=sprintf("%ss",a)),t?t:"0s"}function isTemplate(e){return"{"===e.slice(0,1)&&"}"===e.slice(-1)}function flatMap(e,t){var a=[];return e.forEach(function(e){a=a.concat(t(e))}),a}function notifyOnError(e,t){401===e.status&&$("#token").addClass("templateInput"),$.notify(sprintf("%s error: %s",t,e.statusText))}function getType(e){if(!e||"string"!=typeof e)return null;switch(e){case"places_nearby":return"place";case"addresses":return"address";case"from":return"place";case"to":return"place"}return"s"===e.slice(-1)?e.slice(0,-1):e}function getTextColor(e){function t(e,t){return+("0x"+e.slice(t,t+2))}if("text_color"in e)return"#"+e.text_color;if("color"in e){var a=e.color,n=.21*t(a,0)+.72*t(a,2)+.07*t(a,4);if(128>n)return"white"}return"black"}var _paramValueEverywhere=["depth","count","forbidden_uris[]","filter"],_collections=["addresses","commercial_modes","companies","coord","coverage","disruptions","lines","networks","places","poi_types","pois","physical_modes","routes","stop_areas","stop_points","vehicle_journeys"].sort(),_additionalFeatures=["departures","journeys","places_nearby","pt_objects","route_schedules","stop_schedules","arrivals","places"],_depArrParams=["from_datetime","duration","data_freshness"].concat(_paramValueEverywhere).sort(),_schedulesParams=["from_datetime","duration","items_per_schedule","data_freshness"].concat(_paramValueEverywhere).sort(),_placesParams=["q","type[]","admin_uri[]"].concat(_paramValueEverywhere).sort(),_fallbackMode=["walking","car","bike","bss"].sort(),autocomplete={autocompleteTree:{pathKey:{empty:["coverage","places","coord"],all:_collections},features:{all:_collections.concat(_additionalFeatures).sort()},paramKey:{arrivals:_depArrParams,coord:_paramValueEverywhere,coverage:_paramValueEverywhere,departures:_depArrParams,journeys:["from","to","datetime","datetime_represents","traveler_type","data_freshness","first_section_mode[]","last_section_mode[]"].concat(_paramValueEverywhere).sort(),lines:_paramValueEverywhere,places_nearby:_placesParams.sort(),places:_placesParams,pois:["distance"].concat(_paramValueEverywhere).sort(),pt_objects:["q","type[]"].concat(_paramValueEverywhere),stop_areas:_paramValueEverywhere,stop_points:_paramValueEverywhere,routes:_paramValueEverywhere,route_schedules:_schedulesParams,stop_schedules:_schedulesParams,empty:_paramValueEverywhere},paramValue:{traveler_type:["cyclist","luggage","wheelchair","standard","motorist","fast_walker","slow_walker"].sort(),datetime_represents:["arrival","departure"].sort(),"first_section_mode[]":_fallbackMode,"last_section_mode[]":_fallbackMode}},apiAutocomplete:function(){var e=$("#api input.api"),t=[];for(var a in window.localStorage)0===a.indexOf(apiStoragePrefix)&&t.push({value:a.slice(apiStoragePrefix.length),desc:a});autocomplete._customAutocompleteHelper(e,t,{select:function(t,a){$(e).val(a.item.value),$("#token input.token").val(window.localStorage.getItem(a.item.desc))}})},valueAutoComplete:function(e,t){isDatetimeType(t)?makeDatetime(e):t in this.autocompleteTree.paramValue?autocomplete._customAutocompleteHelper(e,this.autocompleteTree.paramValue[t]):this.staticAutocompleteTypes.indexOf(t)>-1?this.staticAutocomplete(e,t):this.dynamicAutocompleteTypes.indexOf(t)>-1&&this.dynamicAutocomplete(e,t)},addKeyAutocomplete:function(e,t){var a;if("pathKey"!==t||$("#pathFrame").find(".value").length)if("paramKey"===t){var n=$("#featureInput").val();a=this.autocompleteTree[t][n]||this.autocompleteTree[t].empty}else a=this.autocompleteTree[t].all;else a=this.autocompleteTree[t].empty;a=a||[],autocomplete._customAutocompleteHelper(e,a,{select:function(t,a){$(e).val(a.item.value).change()}})},staticAutocompleteTypes:["coverage","physical_modes","poi_types"],staticAutocomplete:function(e,t){var a=$("#api input.api").attr("value"),n=$("#token input.token").val(),r=getCoverage(),o="";o="coverage"===t?a+"/coverage/":a+"/coverage/"+r+"/"+t,$.ajax({headers:isUndefined(n)?{}:{Authorization:"Basic "+btoa(n)},dataType:"json",url:o,success:function(a){var n=[];t="coverage"===t?"regions":t,a[t].forEach(function(e){var a=summary.run(new Context,getType(t),e);n.push({value:e.id,label:a.textContent,desc:a})}),n=n.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),$(e).autocomplete({source:n,minLength:0,scroll:!0,delay:500}).focus(function(){$(e).autocomplete("search","")}).autocomplete("instance")._renderItem=function(e,t){return $("<li>").append(t.desc).appendTo(e)},$(e).is(":focus")&&$(e).autocomplete("search","")},error:function(e,t,a){notifyOnError(e,"Autocomplete")}})},dynamicAutocompleteTypes:["addresses","administrative_regions","commercial_modes","coord","lines","networks","places","pois","routes","stop_areas","stop_points","from","to"],dynamicAutocomplete:function(e,t){var a=function(e){return sprintf("pt_objects/?type[]=%s&q=",e)},n=function(e){return sprintf("places/?type[]=%s&q=",e)},r={addresses:n("address"),administrative_regions:n("administrative_region"),commercial_modes:a("commercial_mode"),coord:n("address"),lines:a("line"),networks:a("network"),places:"places/?&q=",pois:n("poi"),routes:a("route"),stop_areas:a("stop_area"),stop_points:n("stop_point"),from:"places/?&q=",to:"places/?&q="},o=r[t];o&&($(e).autocomplete({delay:200,source:function(e,t){var a=$("#token input.token").val(),n=$("#api input.api").val(),r=getCoverage();r=r?"coverage/"+r:"",$.ajax({url:sprintf("%s/%s/%s%s",n,r,o,encodeURIComponent(e.term)),headers:isUndefined(a)?{}:{Authorization:"Basic "+btoa(a)},success:function(e){var a=[],n=null,r=null;"places"in e?(n=e.places,r="place"):"pt_objects"in e&&(n=e.pt_objects,r="pt_object"),n&&n.forEach(function(e){var t=summary.run(new Context,r,e);a.push({value:e.id,label:t})}),t(a)},error:function(e,a,n){t([]),notifyOnError(e,"Autocomplete")}})}}).autocomplete("instance")._renderItem=function(e,t){return $("<li>").append(t.label).appendTo(e)})},_customAutocompleteHelper:function(e,t,a){var n={source:t,minLength:0,scroll:!0,delay:500};a&&$.extend(!0,n,a),$(e).autocomplete(n).focus(function(){$(this).autocomplete("search","")})}},extended={};extended.make={},extended.make.response=function(e,t){var a=responseCollectionName(t),n=a?t[a]:[],r=getType(a);if(!r)return"Unknown request type";var o=$('<div class="list"/>');return"links"in t&&o.append(render(e,t.links,"links","links")),n.forEach(function(t,n){o.append(render(e,t,r,a,n))}),o},extended.make.journey=function(e,t){if(!("sections"in t))return extended.noExtendedMessage;var a=$('<div class="list"/>');return t.sections.forEach(function(t,n){a.append(render(e,t,"section","sections",n))}),a},extended.make.section=function(e,t){if(!("stop_date_times"in t))return extended.noExtendedMessage;var a=$('<div class="list"/>');return t.stop_date_times.forEach(function(t,n){a.append(render(e,t,"stop_date_time","stop_date_times",n))}),a},extended.make.stop_schedule=function(e,t){var a=$('<div class="list"/>');return t.date_times.forEach(function(t,n){a.append(render(e,t,"date_time","date_times",n))}),a},extended.make.route_schedule=function(e,t){var a=$('<div class="table"/>'),n=$("<table/>");return t.table.rows.forEach(function(t,a){var r=$("<tr/>"),o=$("<td />").addClass("stop-point");o.html(summary.run(e,"stop_point",t.stop_point)),r.append(o),t.date_times.forEach(function(e,t){var a=$("<td />").addClass("time");a.html(summary.formatTime(e.date_time)),r.append(a)}),n.append(r)}),a.append(n),a},extended.defaultExtended=function(e,t,a){var n=extended.noExtendedMessage;if(!(a instanceof Object))return n;var r=!0,o=$('<div class="list"/>');for(var s in a)getType(s)in e.links&&(r=!1,$.isArray(a[s])?a[s].forEach(function(t,a){o.append(render(e,t,getType(s),s,a))}):o.append(render(e,a[s],getType(s),s)));return r?n:o},extended.noExtendedMessage="No extended view yet!",extended.hasExtended=function(e,t,a){return extended.run(e,t,a)!==extended.noExtendedMessage},extended.run=function(e,t,a){try{return t in this.make?this.make[t](e,a):extended.defaultExtended(e,t,a)}catch(n){return console.log(sprintf("extended(%s) thows an exception:",t)),console.log(n),noExtendedMessage}};var map={makeFeatures:{region:function(e,t){if(t.shape){var a=wkt2geojson(t.shape);return map._makePolygon(e,"region",a,t)}return[]},section:function(e,t){var a=t.display_informations;if("street_network"===t.type)switch(t.mode){case"bike":a=map.bikeColor;break;case"car":a=map.carColor}return map._makeString(e,"section",t,a).concat(map._makeStopTimesMarker(e,t))},line:function(e,t){return map._makeString(e,"line",t,t)},journey:function(e,t){if(!("sections"in t))return[];var a=function(t){return map.makeFeatures.section(e,t)};return flatMap(t.sections,a)},address:function(e,t){return map._makeMarker(e,"address",t)},administrative_region:function(e,t){return map._makeMarker("administrative_region",t)},stop_area:function(e,t){return map._makeMarker(e,"stop_area",t)},stop_point:function(e,t){return map._makeMarker(e,"stop_point",t)},place:function(e,t){return map._makeMarker(e,"place",t)},poi:function(e,t){return map._makeMarker(e,"poi",t)},response:function(e,t){var a=responseCollectionName(t);if(null===a)return[];var n=getType(a);if(!(n in map.makeFeatures))return[];var r=function(t){return map.makeFeatures[n](e,t)};return flatMap(t[a],r)}},hasMap:function(e,t,a){return 0!==map.getFeatures(e,t,a).length},getFeatures:function(e,t,a){if(!(map.makeFeatures[t]instanceof Function))return[];try{return map.makeFeatures[t](e,a)}catch(n){return console.log(sprintf("map.makeFeatures[%s] thows an exception:",t)),console.log(n),[]}},run:function(e,t,a){var n=$("<div/>");L.Icon.Default.imagePath="lib/img/leaflet/dist/images";var r=[];if((r=map.getFeatures(e,t,a)).length){n.addClass("leaflet");var o=L.map(n.get(0)).setView([48.843693,2.373303],13);mapLink='<a href="http://openstreetmap.org">OpenStreetMap</a>',mapquestLink='<a href="http://www.mapquest.com//">MapQuest</a>',mapquestPic='<img src="http://developer.mapquest.com/content/osm/mq_logo.png">',L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png",{attribution:"&copy; "+mapLink+". Tiles courtesy of "+mapquestLink+mapquestPic,maxZoom:17,subdomains:"1234"}).addTo(o);var s=L.featureGroup(r).addTo(o);setTimeout(function(){o.invalidateSize(),o.fitBounds(s.getBounds())},100)}else n.addClass("noMap"),n.append("No map");return n},_makeMarker:function(e,t,a){var n,r,o=a;switch(t){case"stop_date_time":o=a.stop_point,n=o.coord.lat,r=o.coord.lon;break;case"place":n=a[a.embedded_type].coord.lat,r=a[a.embedded_type].coord.lon;break;default:n=a.coord.lat,r=a.coord.lon}var s=summary.run(e,t,a),i="place"===t?a.embedded_type:t;return[L.marker([n,r]).bindPopup(map._makeLink(e,i,o,s)[0])]},bikeColor:{color:"CED480"},carColor:{color:"EFBF8F"},_makeString:function(e,t,a,n){if(!("geojson"in a&&a.geojson.coordinates.length))return[];n instanceof Object&&"color"in n||(n={color:"89C6E5"});var r=summary.run(e,t,a);return[L.geoJson(a.geojson,{style:{color:getTextColor(n),weight:6,opacity:1}}),L.geoJson(a.geojson,{style:{color:"#"+n.color,weight:5,opacity:1}}).bindPopup(r)]},_makeStopTimesMarker:function(e,t){var a=t.stop_date_times,n=[];if(a)a.forEach(function(t){n=n.concat(map._makeMarker(e,"stop_date_time",t))});else{var r=t.from,o=t.to;if(!r||!o)return n;n=n.concat(map._makeMarker(e,"place",r)).concat(map._makeMarker(e,"place",o))}return n},_makePolygon:function(e,t,a,n){var r=summary.run(e,t,n),o=map._makeLink(e,t,n,r)[0];return[L.geoJson(a,{color:"#0000FF",opacity:1,weight:3,fillColor:"#0000FF",fillOpacity:.35}).bindPopup(o)]},_makeLink:function(e,t,a,n){return e.makeLink(t,a,n)}},modes={};modes.makePtPicto=function(e){if($.isArray(e)){var t=$("<span/>");return e.forEach(function(e){t.append(modes.makePtPicto(e))}),t}if(!(e instanceof Object&&"id"in e))return $("<span/>");var a="Unknown";switch(e.id){case"physical_mode:Air":a="Air";break;case"physical_mode:Bike":a="Bike";break;case"physical_mode:BikeSharingService":a="BikeSharingService";break;case"physical_mode:Car":a="Car";break;case"physical_mode:Coach":a="Coach";break;case"physical_mode:Funicular":a="Funicular";break;case"physical_mode:Metro":a="Metro";break;case"physical_mode:Taxi":a="Taxi";break;case"physical_mode:Tramway":a="Tramway";break;case"physical_mode:Walking":a="Walking";break;case"physical_mode:Bus":case"physical_mode:BusRapidTransit":case"physical_mode:Trolleybus":a="Bus";break;case"physical_mode:RapidTransit":case"physical_mode:LocalTrain":case"physical_mode:LongDistanceTrain":case"physical_mode:Train":a="Train";break;case"physical_mode:Boat":case"physical_mode:Ferry":a="Boat";break;case"physical_mode:Shuttle":}return modes.makeImg(a,e.name)},modes.makeImg=function(e,t){var a=$("<img/>").addClass("mode").attr("src",sprintf("img/modes/%s.svg",e));return t&&a.attr("alt",t),a},modes.makeSnPicto=function(e){var t="Unknown";return"walking"===e?t="Walking":"bike"===e?t="Bike":0===e.indexOf("bss")?t="BikeSharingService":"car"!==e&&"park"!==e&&"leave_parking"!==e||(t="Car"),modes.makeImg(t,e)},$(document).ready(function(){$("button.add").prop("disabled",!0),$(".addInput").on("input change",function(){$(this).parent().find("button.add").prop("disabled",0===this.value.length)}),$(".addInput").keyup(function(e){13==e.keyCode&&$(this).parent().find("button.add").click()}),$("#featureInput").focusout(updateAddParamAC);var e=parseUrl();if(autocomplete.addKeyAutocomplete($("#featureInput"),"features"),autocomplete.addKeyAutocomplete($("#addPathInput"),"pathKey"),autocomplete.addKeyAutocomplete($("#addParamInput"),"paramKey"),autocomplete.apiAutocomplete(),null===e)return void setAutocomplete();isUndefined(e.token)&&(e.token=""),$("#token input.token").attr("value",e.token),$("#api input.api").attr("value",e.api);var t=null;e.path.forEach(function(e){null===t?t=e:($("#addPathElt").before(makeKeyValue(t,e,"path")),t=null)}),null!==t&&$("#featureInput").val(t);var a=$("#addParam");for(var n in e.query){var r=e.query[n];Array.isArray(r)?r.forEach(function(e){a.before(makeKeyValue(decodeURIComponent(n),decodeURIComponent(e),"parameters"))}):a.before(makeKeyValue(decodeURIComponent(n),decodeURIComponent(r),"parameters"))}setAutocomplete(),updateUrl(null)}),$(document).ready(function(){var e=parseUrl();if(null===e)return void $("#data").html("No request");renderjson.set_show_to_level(3),renderjson.set_max_string_length(60),renderjson.set_sort_objects(!0);var t=(new Date).getTime();$.ajax({headers:isUndefined(e.token)?{}:{Authorization:"Basic "+btoa(e.token)},url:e.request,dataType:"json"}).then(function(a,n,r){setStatus(r,t),$("#data").html(render(new Context(a),a,"response","response")),$("#data input").first().click(),saveToken(e.api,e.token),autocomplete.apiAutocomplete()},function(e,a,n){setStatus(e,t),$("#data").html(render(new Context,e.responseJSON,"error","response")),$("#data input").last().click(),notifyOnError(e,"Response")})});var summary={};summary.make={},summary.make.response=function(e,t){if(!t)return"Error: response is not JSon";if("message"in t)return sprintf("Message: %s",htmlEncode(t.message));if("error"in t&&t.error&&"message"in t.error)return sprintf("Error: %s",htmlEncode(t.error.message));var a="",n=responseCollectionName(t);if(n&&(a+=sprintf(" %s %s ",t[n].length,n)),"pagination"in t){var r=t.pagination,o=r.start_page*r.items_per_page+1;a+=sprintf("(%s-%s of %s results)",o,o+r.items_on_page-1,r.total_result)}return a},summary.make.journey=function(e,t){function a(e){n.append(" > "),n.append(e)}var n=$("<span>").append(summary.formatTime(t.departure_date_time));if("sections"in t){var r=null,o=null;t.sections.forEach(function(e){switch(e.type){case"public_transport":r||(r=o),o=null;break;case"street_network":switch(e.mode){case"bike":o="bike";break;case"car":o="car";break;case"walking":o||(o="walking")}break;case"bss_rent":case"bss_put_back":o="bss"}}),r&&a(modes.makeSnPicto(r)),t.sections.forEach(function(e){"public_transport"===e.type&&a(summary.makePhysicalModesFromSection(e).append(summary.makeLineCode(e.display_informations)))}),o&&a(modes.makeSnPicto(o))}else a(summary.run(e,"place",t.from)),a(sprintf("%s transfer(s)",t.nb_transfers)),a(summary.run(e,"place",t.to));return a(summary.formatTime(t.arrival_date_time)),n.append(", duration: "+durationToString(t.duration)),n},summary.make.links=function(e,t){function a(e){return e.templated?sprintf("{%s}",e.type):e.type}var n=$("<span>");return $.isArray(t)?t.forEach(function(t){n.append(" ").append($("<a>").attr("href",e.makeHref(t.href)).html(a(t)))}):n.append("Links is not an array!"),n},summary.make.pt_object=summary.make.place=function(e,t){return $("<span>").text(t.embedded_type).append(": ").append(summary.run(e,t.embedded_type,t[t.embedded_type]))},summary.make.section=function(e,t){var a=$("<span>"),n=!1;switch(t.type){case"street_network":a.append(modes.makeSnPicto(t.mode));break;case"bss_rent":a.append(modes.makeSnPicto("bss")).append(" rent");break;case"bss_put_back":a.append(modes.makeSnPicto("bss")).append(" put back");break;case"leave_parking":a.append(modes.makeSnPicto("car")).append(" leave parking");break;case"transfer":"walking"===t.transfer_type?a.append(modes.makeSnPicto("walking")):a.append(document.createTextNode(t.transfer_type));break;case"public_transport":n=!0,a.append(summary.makeRoutePoint(e,t));break;default:a.append(t.type)}return"from"in t&&a.append(sprintf(" from %s",htmlEncode(t.from.name))),n&&a.append(sprintf(" at %s",summary.formatTime(t.departure_date_time))),"to"in t&&a.append(sprintf(" to %s",htmlEncode(t.to.name))),n&&a.append(sprintf(" at %s",summary.formatTime(t.arrival_date_time))),"duration"in t&&a.append(sprintf(" during %s",durationToString(t.duration))),a},summary.make.region=function(e,t){return t.id+(t.name?sprintf(" (%s)",t.name):"")},summary.make.line=function(e,t){var a=$("");return t.code&&(a=$("<span>").addClass("line_code").append(t.code),summary.setColors(a,t)),$("<span>").append(modes.makePtPicto(t.physical_modes)).append(a).append(" ").append(document.createTextNode(t.name))},summary.make.stop_date_time=function(e,t){var a=summary.run(e,"stop_point",t.stop_point),n=$("<span>").append(summary.formatTime(t.departure_date_time)).append(" > ").append(summary.formatTime(t.arrival_date_time)).append(" ").append(a);return n},summary.make.departure=function(e,t){var a=$("<span>");return a.append(sprintf("%s : ",summary.formatTime(t.stop_date_time.departure_date_time))),a.append(summary.makeRoutePoint(e,t)),a},summary.make.arrival=function(e,t){var a=$("<span>");return a.append(sprintf("%s : ",summary.formatTime(t.stop_date_time.arrival_date_time))),a.append(summary.makeRoutePoint(e,t)),a},summary.make.stop_schedule=function(e,t){return summary.makeRoutePoint(e,t)},summary.make.date_time=function(e,t){var a=$("<span>");return a.append(summary.formatTime(t.date_time)),a.append(" ("+t.data_freshness+")"),a},summary.make.route_schedule=function(e,t){return summary.makeRoutePoint(e,t)},summary.make.physical_mode=function(e,t){return $("<span/>").append(modes.makePtPicto(t)).append(document.createTextNode(" "+t.name))},summary.make.connection=function(e,t){return $("<span/>").text(sprintf("%s > %s, duration: %s, display_duration: %s",t.origin.id,t.destination.id,durationToString(t.duration),durationToString(t.display_duration)))},summary.setColors=function(e,t){"color"in t&&(e.css("background-color","#"+t.color),e.css("color",getTextColor(t)))},summary.defaultSummary=function(e,t,a){if(!(a instanceof Object))return"Invalid object";var n=$("<span/>");return"physical_modes"in a&&$.isArray(a.physical_modes)&&a.physical_modes.forEach(function(e){n.append(modes.makePtPicto(e))}),"label"in a?n.append(document.createTextNode(a.label)):"name"in a?n.append(document.createTextNode(a.name)):"id"in a?n.append(document.createTextNode(a.id)):n.append("no summary"),n},summary.formatDatetime=function(e){var t=e.replace(/(\d{4})(\d{2})(\d{2})T(\d{2})(\d{2})(\d{2})/,"$1-$2-$3 $4:$5:$6");return"00"===t.slice(-2)?t.slice(0,-3):t},summary.formatTime=function(e){return summary.formatDatetime(e).split(" ")[1]},summary.makePhysicalModesFromSection=function(e){if("links"in e){var t=e.links.map(function(t){return"physical_mode"==t.type?{id:t.id,name:e.display_informations.physical_mode}:null});return modes.makePtPicto(t)}},summary.makeLineCode=function(e){if(!e.code)return $("");var t=$("<span>").addClass("line_code").append(e.code);return summary.setColors(t,e),t},summary.makeRoutePoint=function(e,t){var a=$("<span/>");return"route"in t?a.append(modes.makePtPicto(t.route.physical_modes)):"links"in t&&"display_informations"in t&&a.append(summary.makePhysicalModesFromSection(t)),a.append(summary.makeLineCode(t.display_informations)),a.append(" > "),a.append(t.display_informations.direction),t.stop_point&&(a.append(" at "),a.append(summary.run(e,"stop_point",t.stop_point))),a},summary.run=function(e,t,a){var n;try{n=t in summary.make?summary.make[t](e,a):summary.defaultSummary(e,t,a)}catch(r){console.log(sprintf("summary(%s) thows an exception:",t)),console.log(r),n="summary error"}return n instanceof jQuery?n.get(0):"string"==typeof n?$("<span>").text(n).get(0):n};var apiStoragePrefix="navitiaPlayground.";